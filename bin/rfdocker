#!/usr/bin/env bash

set -e

### globals ####################################################################

this_path="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

### main #######################################################################

if [ -z "$RESULTS_PATH" ]; then
  echo -e "[rfdocker] Variable 'RESULTS_PATH' is not explicitly set for outputs"
  echo -e "[rfdocker] -> assuming $this_path/results/ \n"
  results_path="$this_path/results"
else
  results_path="$(cd "$RESULTS_PATH" && pwd)"
fi

# Exit with non-zero, due to set -e, if TESTS_PATH is not set
set -u
tests_path="$(cd "$TESTS_PATH" && pwd)"

docker run --rm -ti --name rfdocker \
  -e UNAME="robot" \
  -e GNAME="robot" \
  -e UID=$(id -u) \
  -e GID=$(id -g) \
  -v "$results_path":/home/robot/results \
  -v "$tests_path":/home/robot/tests \
  rfdocker:latest "${@:-tests}"
